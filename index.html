<!DOCTYPE html>
<html lang="en"></html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Soundmap Artist Guesser Solver</title>
    <style>
        /* Updated styles */
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            background-color: #121212; /* Background color */
        }
    
        h1 {
            margin-top: 20px;
            color: #f4f4f4; /* Heading color */
        }
    
        input {
            margin-top: 20px;
            padding: 10px;
            font-size: 14px;
            width: 300px;
            background-color: #1c1c1c; /* Input background color */
            color: #f4f4f4; /* Input text color */
            border: none;
        }
    
        .button-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 5px;
            margin-top: 20px;
            height: 50px; /* Fixed height for guess boxes */
            overflow: hidden; /* Prevent size change */
        }
    
        button {
            width: 100%;
            height: 50px;
            font-size: 14px;
            background-color: #1c1c1c; /* Button background color */
            color: #f4f4f4; /* Button text color */
            border: none;
        }
    
        .green {
            background-color: #159643; /* Correct option color */
        }
    
        .orange {
            background-color: #b19600; /* Close option color */
        }
    
        .grey {
            background-color: grey; /* Wrong option color */
        }
    
        .results-container {
            width: 80%;
            margin-top: 40px;
            padding: 10px;
            border-top: 2px solid #000;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
    
        .artist-list-wrapper {
            width: 100%;
            overflow-x: auto;
        }
    
        table {
            width: 100%;
            border-collapse: collapse;
        }
    
        th, td {
            padding: 8px;
            border-bottom: 1px solid #ddd;
            color: #f4f4f4; /* Text color */
            text-align: left;
            word-wrap: break-word;
        }
    
        th {
            font-weight: bold;
        }
    
        select {
            margin-top: 10px;
            padding: 5px;
            font-size: 14px;
            position: absolute;
            z-index: 10;
        }
    
        .button-text {
            display: inline-block;
            margin-bottom: 5px;
        }
    
        .guess-container {
            margin-top: 20px;
            width: 80%;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
    
        .guess-title {
            font-weight: bold;
            margin-top: 20px;
            color: #88888a; /* Guess title color */
        }
    
        .footer-text {
            font-weight: bold;
            margin-top: 20px;
            color: #f4f4f4; /* Footer text color */
        }
    
        @media (max-width: 600px) {
            input {
                width: 90%;
            }
    
            .results-container {
                width: 100%;
            }
    
            .guess-container {
                width: 100%;
            }
    
            .artist-list-wrapper {
                overflow-x: auto;
            }
        }
    
        /* Modal styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.4); /* Modal background color */
        }
    
        .modal-content {
            background-color: #fefefe; /* Modal content background color */
            margin: 15% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
            max-width: 300px;
        }
    
        .close {
            color: #aaa; /* Close button color */
            float: right;
            font-size: 28px;
            font-weight: bold;
        }
    
        .close:hover,
        .close:focus {
            color: black; /* Close button hover color */
            text-decoration: none;
            cursor: pointer;
        }
    
        .modal-option {
            margin: 10px 0;
            padding: 10px;
            background-color: #ddd; /* Modal option background color */
            cursor: pointer;
        }
    
        .modal-option:hover {
            background-color: #ccc; /* Modal option hover color */
        }
    
        /* Search result styles */
        #searchResults div {
            color: #f4f4f4; /* Search result text color */
        }
    </style>    
</head>
<body>

    <div class="footer-text">Made by u/CATninja58. Soundmap user: jeddosterives</div>
    <h1>Soundmap Artist Guesser Solver</h1>

    <input type="text" id="artistSearch" placeholder="Enter artist name" oninput="searchArtist()">
    <div id="searchResults"></div>
    <div id="guessesContainer" class="guess-container" style="margin-top: 40px; margin-bottom: 20px; gap: 40px;">
        <!-- Guesses will be dynamically added here -->
    </div>

    <div style="height: 60px;"></div> <!-- Added space between the two containers -->

    <div id="bestGuessContainer" class="guess-container" style="margin-top: 40px; margin-bottom: 20px;">
        <!-- Best guess will be dynamically added here -->
    </div>

    <button id="bestGuessButton" onclick="makeBestGuessNext()">Click to make <span id="bestGuessName"></span> your next guess</button>
    <script>
        function updateBestGuessName() {
            const bestGuessElement = document.getElementById("bestGuessContainer").querySelector("div");
            const bestGuessName = bestGuessElement ? bestGuessElement.textContent.replace("Best Guess: ", "") : "";
            document.getElementById("bestGuessName").textContent = bestGuessName;
            document.getElementById("bestGuessButton").innerHTML = `Click to make <span id="bestGuessName">${bestGuessName}</span> your next guess!`;
        }

        document.addEventListener("DOMContentLoaded", updateBestGuessName);
    </script>

    <script>
        function makeBestGuessNext() {
            if (filteredArtists.length === 0) return;

            const sortedByDebut = [...filteredArtists].sort((a, b) => parseInt(a.debut) - parseInt(b.debut));
            const medianDebutArtist = sortedByDebut[Math.floor(sortedByDebut.length / 2)];

            const sameDebutArtists = sortedByDebut.filter(artist => artist.debut === medianDebutArtist.debut);
            const sortedByPopularity = sameDebutArtists.sort((a, b) => parseInt(a.popularity) - parseInt(b.popularity));
            const medianPopularityArtist = sortedByPopularity[Math.floor(sortedByPopularity.length / 2)];

            const bestGuess = medianPopularityArtist.artist;
            displayArtistInfo(bestGuess);
            updateBestGuessName();
        }
    </script>
    
    <div class="results-container">
        <div class="footer-text">Scroll to the right for all the stats on artists</div>
        <div class="artist-list-wrapper">
            <table>
                <thead>
                    <tr>
                        <th style="min-width: 300px;">Artist</th>
                        <th style="min-width: 200px;">Debut</th>
                        <th style="min-width: 250px;">Popularity</th>
                        <th style="min-width: 200px;">Members</th>
                        <th style="min-width: 200px;">Genre</th>
                        <th style="min-width: 200px;">Country</th>
                        <th style="min-width: 200px;">Gender</th>
                    </tr>
                </thead>
                <tbody id="artistList"></tbody>
            </table>
        </div>
        <!-- Artists matching the guess will be displayed here -->
    </div>
    <div class="footer-text">Made by u/CATninja58. Soundmap user: jeddosterives</div>

    <!-- Modal structure -->
    <div id="myModal" class="modal"></div>
        <div class="modal-content">
            <span class="close">&times;</span>
            <div id="modalOptions"></div>
        </div>
    </div>

    <script>
        let artistsData = [];
        let artistInfo = {};
        let filteredArtists = [];
        let guesses = [];
        let guessCount = 0;

        function isAndroid() {
            return /Android/i.test(navigator.userAgent);
        }

        function loadCSV() {
            const csvUrl = "https://raw.githubusercontent.com/CATninja58/Soundmapsolver/main/MasterArtistList.csv";
            fetch(csvUrl)
                .then(response => response.text())
                .then(csvText => parseCSV(csvText))
                .catch(error => console.error("Error loading CSV file:", error));
        }

        function parseCSV(csvText) {
            const rows = csvText.split("\n");
            rows.shift();
            artistsData = rows.map(row => {
                const [artist, debut, popularity, members, genre, country, gender] = row.split(",");
                return { artist, debut, popularity, members, genre, country, gender };
            });
            filteredArtists = [...artistsData];
            displayArtists();
        }

        function searchArtist() {
            const query = document.getElementById("artistSearch").value.toLowerCase();
            const searchResults = document.getElementById("searchResults");
            searchResults.innerHTML = '';

            if (query) {
                const matches = artistsData.filter(artist => artist.artist.toLowerCase().includes(query));
                matches.forEach(match => {
                    const resultDiv = document.createElement("div");
                    resultDiv.textContent = match.artist;
                    resultDiv.onclick = () => {
                        displayArtistInfo(match.artist);
                        document.getElementById("artistSearch").value = '';
                        searchResults.innerHTML = '';
                    };
                    searchResults.appendChild(resultDiv);
                });
            }
        }

        function displayArtistInfo(artistName) {
            const artist = artistsData.find(artist => artist.artist === artistName);
            if (artist) {
                artistInfo = artist;
                filteredArtists = [artist];
                displayArtists();
                addGuess(artist);
            }
        }

        function addGuess(artist) {
            guessCount++;
            const guessesContainer = document.getElementById("guessesContainer");

            const guessTitle = document.createElement("div");
            guessTitle.classList.add("guess-title");
            guessTitle.textContent = `Guess #${guessCount}`;
            guessesContainer.appendChild(guessTitle);

            const artistName = document.createElement("div");
            artistName.textContent = artist.artist;
            artistName.style.color = "#f4f4f4";
            guessesContainer.appendChild(artistName);

            const guessBoxes = document.createElement("div");
            guessBoxes.style.height = "50px"; /* Set fixed height */
            guessBoxes.classList.add("button-container");
            guessBoxes.style.height = "50px"; /* Set fixed height */
            guessBoxes.classList.add("button-container");
            guessBoxes.id = `guess${guessCount}Container`;
            guessesContainer.appendChild(guessBoxes);

            const guess = { artist, selectedOptions: {} };
            guesses.push(guess);

            createButtons(artist, guessBoxes, guess);
        }

        function createButtons(artist, container, guess) {
            const categories = ["debut", "popularity", "members", "genre", "country", "gender"];
            categories.forEach(category => {
                const button = document.createElement("button");
                button.innerHTML = `<span class="button-text">${category.charAt(0).toUpperCase() + category.slice(1)}: ${artist[category]}</span>`;
                button.onclick = () => showDropdown(button, category, artist[category], guess);
                container.appendChild(button);
            });
        }

        function showDropdown(button, category, value, guess) {
            if (isAndroid()) {
                showModal(button, category, value, guess);
            } else {
                const dropdown = document.createElement("select");
                const options = getCategoryOptions(category);

                const defaultOption = document.createElement("option");
                defaultOption.value = "";
                defaultOption.textContent = "Choose an option";
                dropdown.appendChild(defaultOption);

                options.forEach(option => {
                    const optionElement = document.createElement("option");
                    optionElement.value = option;
                    optionElement.textContent = option;
                    dropdown.appendChild(optionElement);
                });

                dropdown.onchange = () => {
                    const selectedOption = dropdown.value;
                    guess.selectedOptions[category] = selectedOption;
                    changeButtonColor(button, selectedOption);
                    button.innerHTML = `<span class="button-text">${category.charAt(0).toUpperCase() + category.slice(1)}: ${value} (${selectedOption})</span>`;
                    filterArtists();
                };

                dropdown.size = options.length;
                button.innerHTML = `<span class="button-text">${category.charAt(0).toUpperCase() + category.slice(1)}: ${value} (Choose Option)</span>`;
                button.appendChild(dropdown);
                dropdown.focus();
            }
        }

        function showModal(button, category, value, guess) {
            const modal = document.getElementById("myModal");
            const modalOptions = document.getElementById("modalOptions");
            modalOptions.innerHTML = '';

            const options = getCategoryOptions(category);
            options.forEach(option => {
                const optionDiv = document.createElement("div");
                optionDiv.classList.add("modal-option");
                optionDiv.textContent = option;
                optionDiv.onclick = () => {
                    guess.selectedOptions[category] = option;
                    changeButtonColor(button, option);
                    button.innerHTML = `<span class="button-text">${category.charAt(0).toUpperCase() + category.slice(1)}: ${value} (${option})</span>`;
                    filterArtists();
                    modal.style.display = "none";
                };
                modalOptions.appendChild(optionDiv);
            });

            modal.style.display = "block";

            const closeModal = document.getElementsByClassName("close")[0];
            closeModal.onclick = () => {
                modal.style.display = "none";
            };

            window.onclick = (event) => {
                if (event.target == modal) {
                    modal.style.display = "none";
                }
            };
        }

        function getCategoryOptions(category) {
            switch (category) {
                case 'debut':
                    return ['correct', 'later ^', 'earlier v', 'close ^', 'close v'];
                case 'popularity':
                    return ['correct', 'higher ^', 'lower v', 'close ^', 'close v'];
                case 'members':
                case 'genre':
                case 'country':
                case 'gender':
                    return ['correct', 'wrong'];
                default:
                    return [];
            }
        }

        function changeButtonColor(button, option) {
            if (option === 'correct') {
                button.className = 'green';
            } else if (option === 'close ^' || option === 'close v') {
                button.className = 'orange';
            } else if (option === 'wrong' || option === 'later ^' || option === 'earlier v' || option === 'higher ^' || option === 'lower v') {
                button.className = 'grey';
            }
        }

        function filterArtists() {
            filteredArtists = artistsData.filter(artist => {
                return guesses.every(guess => {
                    return Object.keys(guess.selectedOptions).every(category => {
                        const option = guess.selectedOptions[category];
                        const artistValue = artist[category];

                        if (!option) return true;

                        if (option === 'correct') {
                            return artistValue === guess.artist[category];
                        } else if (category === 'debut') {
                            return filterDebut(option, artistValue, guess.artist[category]);
                        } else if (category === 'popularity') {
                            return filterPopularity(option, artistValue, guess.artist[category]);
                        } else if (option === 'wrong') {
                            return artistValue !== guess.artist[category];
                        } else {
                            return false;
                        }
                    });
                });
            });

            displayArtists();
            calculateBestGuess();
        }

        function filterDebut(option, artistValue, guessValue) {
            if (option === 'correct') {
                return artistValue === guessValue;
            } else if (option === 'later ^') {
                return parseInt(artistValue) > parseInt(guessValue) && Math.abs(parseInt(artistValue) - parseInt(guessValue)) > 5;
            } else if (option === 'earlier v') {
                return parseInt(artistValue) < parseInt(guessValue) && Math.abs(parseInt(artistValue) - parseInt(guessValue)) > 5;
            } else if (option === 'close ^') {
                return parseInt(artistValue) > parseInt(guessValue) && Math.abs(parseInt(artistValue) - parseInt(guessValue)) <= 5;
            } else if (option === 'close v') {
                return parseInt(artistValue) < parseInt(guessValue) && Math.abs(parseInt(artistValue) - parseInt(guessValue)) <= 5;
            } else {
                return false;
            }
        }

        function filterPopularity(option, artistValue, guessValue) {
            if (option === 'correct') {
                return artistValue === guessValue;
            } else if (option === 'higher ^') {
                return parseInt(artistValue) < parseInt(guessValue) && Math.abs(parseInt(artistValue) - parseInt(guessValue)) > 50;
            } else if (option === 'lower v') {
                return parseInt(artistValue) > parseInt(guessValue) && Math.abs(parseInt(artistValue) - parseInt(guessValue)) > 50;
            } else if (option === 'close ^') {
                return parseInt(artistValue) < parseInt(guessValue) && Math.abs(parseInt(artistValue) - parseInt(guessValue)) <= 50;
            } else if (option === 'close v') {
                return parseInt(artistValue) > parseInt(guessValue) && Math.abs(parseInt(artistValue) - parseInt(guessValue)) <= 50;
            } else {
                return false;
            }
        }

        function displayArtists() {
            const artistList = document.getElementById("artistList");
            artistList.innerHTML = '';

            filteredArtists.forEach(artist => {
                const artistItem = document.createElement("tr");

                artistItem.innerHTML = `
                    <td>${artist.artist}</td>
                    <td>${artist.debut}</td>
                    <td>${artist.popularity}</td>
                    <td>${artist.members}</td>
                    <td>${artist.genre}</td>
                    <td>${artist.country}</td>
                    <td>${artist.gender}</td>
                `;

                artistList.appendChild(artistItem);
            });
        }

        function calculateBestGuess() {
            if (filteredArtists.length === 0) return;

            const sortedByDebut = [...filteredArtists].sort((a, b) => parseInt(a.debut) - parseInt(b.debut));
            const medianDebutArtist = sortedByDebut[Math.floor(sortedByDebut.length / 2)];

            const sameDebutArtists = sortedByDebut.filter(artist => artist.debut === medianDebutArtist.debut);
            const sortedByPopularity = sameDebutArtists.sort((a, b) => parseInt(a.popularity) - parseInt(b.popularity));
            const medianPopularityArtist = sortedByPopularity[Math.floor(sortedByPopularity.length / 2)];

            const bestGuess = medianPopularityArtist.artist;
            const bestGuessElement = document.createElement("div");
            bestGuessElement.textContent = `Best Guess: ${bestGuess}`;
            bestGuessElement.style.color = "#f4f4f4";
            const bestGuessContainer = document.getElementById("bestGuessContainer");
            bestGuessContainer.innerHTML = '';
            bestGuessContainer.appendChild(bestGuessElement);
        }

        loadCSV();
    </script>

</body>
</html>
